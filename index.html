<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Christmas</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --console-color: #2e2e42;
            --accent-color: #e94560;
        }

        body {
            background-color: #000;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            font-family: 'VT323', monospace;
        }

        /* กรอบจอ Retro แบบเต็มหน้าจอ */
        .crt-monitor {
            background: var(--console-color);
            padding: 1.5vmin; /* ขอบจอปรับตามขนาดจอ */
            border-radius: 20px;
            box-shadow: 
                0 0 0 10px #1a1a1a, /* ขอบนอก */
                0 0 50px rgba(255, 255, 255, 0.1);
            position: relative;
            
            /* ปรับให้เกือบเต็มจอ แต่เหลือขอบไว้นิดหน่อยให้ดูสวย */
            width: 95vw;
            height: 92vh;
            
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* พื้นที่แสดงผลด้านใน */
        .screen-container {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: #000;
            border-radius: 4px;
            overflow: hidden;
            border: 4px solid #111;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }

        canvas {
            background-color: #0f380f;
            display: block;
            width: 100%;
            height: 100%;
            
            /* Pixel Art คมชัด */
            image-rendering: pixelated; 
            image-rendering: crisp-edges;
        }

        /* Scanlines */
        .scanlines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.15) 50%,
                rgba(0,0,0,0.15)
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 10;
        }
        
        /* เงาสะท้อนหน้าจอโค้ง */
        .screen-glare {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0.2) 90%);
            pointer-events: none;
            z-index: 11;
        }

        h1 {
            position: absolute;
            top: 15px;
            left: 20px;
            margin: 0;
            color: rgba(255, 255, 255, 0.5);
            text-shadow: 2px 2px #000;
            z-index: 12;
            font-size: 1.5rem;
            pointer-events: none;
            letter-spacing: 2px;
        }
        
        .status-bar {
            position: absolute;
            bottom: 15px;
            right: 20px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 1.2rem;
            z-index: 12;
            pointer-events: none;
        }

    </style>
</head>
<body>

    <div class="crt-monitor">
        <div class="screen-container">
            <canvas id="gameCanvas"></canvas>
            <div class="scanlines"></div>
            <div class="screen-glare"></div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        ctx.imageSmoothingEnabled = false;

        // --- Configuration ---
        const TARGET_HEIGHT = 64; 
        let virtualWidth = 64;    

        // --- Game State ---
        let time = 0;
        let snowParticles = [];
        // snowIntensity = 1 ตลอดเวลา (ตกปกติ ไม่พายุ)
        let snowIntensity = 1; 
        let lightMode = 1; 
        let skyMode = 0; 
        let santaPos = -20; 
        let isSantaFlying = false;

        // --- Palette Colors ---
        const colors = {
            black: "#000000",
            dark_blue: "#1D2B53",
            dark_purple: "#7E2553",
            dark_green: "#008751",
            brown: "#AB5236",
            dark_gray: "#5F574F",
            light_gray: "#C2C3C7",
            white: "#FFF1E8",
            red: "#FF004D",
            orange: "#FFA300",
            yellow: "#FFEC27",
            green: "#00E436",
            blue: "#29ADFF",
            indigo: "#83769C",
            pink: "#FF77A8",
            peach: "#FFCCAA"
        };

        const skyColors = [colors.dark_blue, colors.orange, colors.black];

        // --- Initialization & Resize Logic ---
        function resize() {
            // คำนวณ Aspect Ratio ของ Container (ไม่ใช่ window แล้ว เพราะอยู่ในขอบ)
            const container = document.querySelector('.screen-container');
            const aspect = container.clientWidth / container.clientHeight;
            
            canvas.height = TARGET_HEIGHT;
            canvas.width = Math.ceil(TARGET_HEIGHT * aspect);
            virtualWidth = canvas.width;
            
            initSnow();
            marqueeX = virtualWidth;
            ctx.imageSmoothingEnabled = false;
        }

        window.addEventListener('resize', resize);
        // เพิ่ม setTimeout เพื่อรอให้ layout วาดเสร็จก่อนคำนวณขนาด
        window.addEventListener('load', () => setTimeout(resize, 100));

        function initSnow() {
            snowParticles = [];
            const particleCount = Math.floor(virtualWidth * 1.5); 
            
            for(let i=0; i<particleCount; i++) {
                snowParticles.push({
                    x: Math.random() * virtualWidth,
                    y: Math.random() * TARGET_HEIGHT,
                    speed: 0.1 // ความเร็วคงที่
                });
            }
        }

        function init() {
            resize(); 
            requestAnimationFrame(loop);
        }

        // --- Drawing Helpers ---
        function drawPixel(x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(Math.floor(x), Math.floor(y), 1, 1);
        }

        function drawRect(x, y, w, h, color) {
            ctx.fillStyle = color;
            ctx.fillRect(Math.floor(x), Math.floor(y), w, h);
        }

        // --- Auto Director ---
        function autoDirector() {
            if (time % 120 === 0) lightMode = (lightMode + 1) % 3;
            if (time % 300 === 0) skyMode = (skyMode + 1) % 3;
            // ลบบรรทัดเปลี่ยน snowIntensity ออก เพื่อให้หิมะตกปกติเสมอ
            
            if (!isSantaFlying && Math.random() < 0.04) {
                callSanta();
            }
        }

        // --- Update & Draw Loop ---
        function loop() {
            time++;
            autoDirector();
            
            // 1. Clear Screen / Sky
            ctx.fillStyle = skyColors[skyMode];
            ctx.fillRect(0, 0, virtualWidth, TARGET_HEIGHT);

            // 2. Stars
            if (skyMode !== 1) {
                for(let i=0; i<20; i++) {
                     let starX = (i * 17) % virtualWidth; 
                     let starY = (i * 13) % (TARGET_HEIGHT/2);
                     if ((time + i*10) % 40 < 20) {
                         drawPixel(starX, starY, colors.white);
                     }
                }
            }

            // 3. Ground
            drawRect(0, 50, virtualWidth, 14, colors.white); 
            drawRect(0, 52, virtualWidth, 1, colors.light_gray);

            // 4. Tree
            drawTree(virtualWidth / 2, 50);

            // 5. Santa
            if (isSantaFlying) {
                updateSanta();
                drawSanta(santaPos, 15 + Math.sin(time * 0.2) * 3);
            }

            // 6. Snow
            updateAndDrawSnow();

            // 7. Marquee Text
            drawMarquee();

            requestAnimationFrame(loop);
        }

        // --- Object: Tree ---
        function drawTree(x, bottomY) {
            x = Math.floor(x);
            drawRect(x-2, bottomY-4, 4, 4, colors.brown); 
            const layers = [
                {w: 24, h: 6, y: bottomY-10},
                {w: 18, h: 6, y: bottomY-15},
                {w: 12, h: 5, y: bottomY-19},
                {w: 6, h: 4, y: bottomY-22}
            ];
            layers.forEach(l => {
                let startX = x - (l.w / 2);
                for(let i=0; i<l.h; i++) {
                   drawRect(startX + i, l.y + i, l.w - (i*2), 1, colors.dark_green);
                }
            });

            // Star
            const starColor = (time % 30 < 15) ? colors.yellow : colors.white;
            drawPixel(x-1, bottomY-24, starColor);
            drawPixel(x, bottomY-25, starColor);
            drawPixel(x, bottomY-23, starColor);
            drawPixel(x+1, bottomY-24, starColor);

            // Lights
            const lightPositions = [
                {x: -6, y: -8}, {x: 4, y: -6}, 
                {x: -3, y: -13}, {x: 2, y: -12},
                {x: 0, y: -17}
            ];
            lightPositions.forEach((pos, index) => {
                let color = colors.red;
                if (lightMode === 0) color = (index % 2 === 0) ? colors.red : colors.blue;
                else if (lightMode === 1) color = (Math.floor(time / 10) % 2 === 0) ? colors.red : colors.yellow;
                else if (lightMode === 2) {
                    const disco = [colors.red, colors.blue, colors.yellow, colors.pink, colors.green];
                    color = disco[(Math.floor(time / 5) + index) % disco.length];
                }
                drawPixel(x + pos.x, bottomY + pos.y, color);
            });
        }

        // --- Object: Santa ---
        function callSanta() {
            santaPos = -30;
            isSantaFlying = true;
        }

        function updateSanta() {
            santaPos += 0.5;
            if (santaPos > virtualWidth + 20) {
                isSantaFlying = false;
            }
        }

        function drawSanta(x, y) {
            x = Math.floor(x);
            y = Math.floor(y);
            drawPixel(x+10, y+2, colors.brown); 
            drawPixel(x+11, y+1, colors.brown);
            drawPixel(x+12, y+2, colors.red); 
            drawRect(x, y+3, 6, 2, colors.brown); 
            drawPixel(x, y+2, colors.red); 
            drawPixel(x+1, y+1, colors.white); 
            drawPixel(x+1, y, colors.red); 
        }

        // --- Object: Snow ---
        function updateAndDrawSnow() {
            snowParticles.forEach(p => {
                drawPixel(p.x, p.y, colors.white);
                p.y += p.speed;
                // ตัดเงื่อนไขพายุ (wind) ออกไป ให้ตกตรงๆ เท่านั้น
                
                if (p.y > TARGET_HEIGHT) {
                    p.y = -2;
                    p.x = Math.random() * virtualWidth;
                }
            });
        }

        // --- Marquee Text ---
        const fontData = {
            'M': [[1,0,0,0,1],[1,1,0,1,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1]],
            'E': [[1,1,1],[1,0,0],[1,1,1],[1,0,0],[1,1,1]],
            'R': [[1,1,0],[1,0,1],[1,1,0],[1,0,1],[1,0,1]],
            'Y': [[1,0,1],[1,0,1],[0,1,0],[0,1,0],[0,1,0]],
            ' ': [[0,0],[0,0],[0,0],[0,0],[0,0]],
            'C': [[0,1,1],[1,0,0],[1,0,0],[1,0,0],[0,1,1]],
            'H': [[1,0,1],[1,0,1],[1,1,1],[1,0,1],[1,0,1]],
            'I': [[1],[1],[1],[1],[1]],
            'S': [[0,1,1],[1,0,0],[0,1,0],[0,0,1],[1,1,0]],
            'T': [[1,1,1],[0,1,0],[0,1,0],[0,1,0],[0,1,0]],
            'A': [[0,1,0],[1,0,1],[1,1,1],[1,0,1],[1,0,1]]
        };

        let marqueeX = 64;
        
        function drawMarquee() {
            marqueeX -= 0.5;
            const message = "MERRY CHRISTMAS";
            const textY = 4;
            
            let currentX = marqueeX;
            let totalWidth = 0;

            for (let i = 0; i < message.length; i++) {
                const char = message[i];
                const matrix = fontData[char];
                if (!matrix) continue;

                let charColor = (i % 2 === 0) ? colors.red : colors.green;

                for (let r = 0; r < matrix.length; r++) {
                    for (let c = 0; c < matrix[r].length; c++) {
                        if (matrix[r][c] === 1) {
                            if (currentX + c >= 0 && currentX + c < virtualWidth) {
                                drawPixel(currentX + c, textY + r, charColor);
                            }
                        }
                    }
                }
                
                const charWidth = matrix[0].length;
                currentX += charWidth + 1;
                totalWidth += charWidth + 1;
            }

            if (marqueeX < -totalWidth) {
                marqueeX = virtualWidth; 
            }
        }

        init();

    </script>
</body>
</html>
