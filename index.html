<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chunky Christmas Pixel Loop v2</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #0f0f23;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #player-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            image-rendering: pixelated; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Pixel Art */
        }

        .overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            color: rgba(255, 255, 255, 0.7);
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
        }
    </style>
</head>
<body>

<div id="player-container">
    <canvas id="pixelCanvas"></canvas>
    <div class="overlay">LIVE üî¥ NORTH POLE BROADCAST</div>
</div>

<script>
    const canvas = document.getElementById('pixelCanvas');
    const ctx = canvas.getContext('2d');

    // --- CONFIGURATION ---
    const TARGET_GAME_HEIGHT = 180; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô

    let gameWidth = 0;
    let gameHeight = 0;
    let frameCount = 0;
    const scrollSpeed = 1.0; 

    // Palette (Refined Colors)
    const PALETTE = {
        skyTop: '#0C0C1D',
        skyBottom: '#202040',
        moon: '#FFD700',
        snow: '#E3F2FD',
        ground: '#DDDDDD',
        road: '#263238',
        treeDark: '#1B5E20',
        treeLight: '#2E7D32',
        gold: '#FFC107',
        santaRed: '#D32F2F',
        sleigh: '#5D4037',
        skin: '#FFCCBC'
    };

    // Game Objects
    let stars = [];
    let mountains = [];
    let buildings = [];
    let groundObjects = [];
    let snowParticles = [];

    // --- RESIZE LOGIC ---
    function resize() {
        const aspect = window.innerWidth / window.innerHeight;
        gameHeight = TARGET_GAME_HEIGHT;
        gameWidth = Math.ceil(gameHeight * aspect);
        canvas.width = gameWidth;
        canvas.height = gameHeight;
        ctx.imageSmoothingEnabled = false;
        initScene();
    }
    window.addEventListener('resize', resize);

    // --- INITIALIZATION ---
    function initScene() {
        // Stars
        stars = [];
        for(let i=0; i<60; i++) {
            stars.push({
                x: Math.random() * gameWidth,
                y: Math.random() * (gameHeight * 0.5),
                size: Math.random() < 0.1 ? 2 : 1, // ‡∏°‡∏µ‡∏î‡∏≤‡∏ß‡πÉ‡∏´‡∏ç‡πà‡∏ö‡πâ‡∏≤‡∏á
                blinkSpeed: Math.random() * 0.1
            });
        }
        
        // Buildings (Background)
        buildings = [];
        let bx = 0;
        while(bx < gameWidth + 50) {
            const w = 15 + Math.random() * 20;
            buildings.push({
                x: bx,
                w: w,
                h: 20 + Math.random() * 30,
                windows: Math.random() > 0.3
            });
            bx += w;
        }

        groundObjects = [];
    }

    // --- DRAWING HELPERS ---
    function rect(x, y, w, h, color) {
        ctx.fillStyle = color;
        ctx.fillRect(Math.floor(x), Math.floor(y), w, h);
    }

    // --- DETAILED OBJECTS ---

    function drawDetailedSanta(x, y) {
        // Float effect
        const bob = Math.sin(frameCount * 0.05) * 2;
        y += bob;

        // 1. ‡∏Å‡∏ß‡∏≤‡∏á‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏£‡πå (4 ‡∏ï‡∏±‡∏ß - 2 ‡∏Ñ‡∏π‡πà)
        // ‡∏Ñ‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤
        drawReindeer(x + 65, y + 2, 0); 
        drawReindeer(x + 80, y + 5, 5);
        // ‡∏Ñ‡∏π‡πà‡∏´‡∏•‡∏±‡∏á (‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏¥‡∏ï‡∏¥)
        drawReindeer(x + 45, y + 2, 10);
        drawReindeer(x + 60, y + 5, 15);

        // 2. ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏ö‡∏±‡∏á‡πÄ‡∏´‡∏µ‡∏¢‡∏ô
        ctx.strokeStyle = '#3E2723';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(x + 20, y + 5); // ‡∏°‡∏∑‡∏≠‡∏ã‡∏≤‡∏ô‡∏ï‡πâ‡∏≤
        ctx.lineTo(x + 80, y + 5); // ‡∏ñ‡∏∂‡∏á‡∏Å‡∏ß‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤
        ctx.stroke();

        // 3. ‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô (Sleigh) - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô
        // ‡∏Ç‡∏≤‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô (Runner)
        ctx.strokeStyle = PALETTE.gold;
        ctx.beginPath();
        ctx.moveTo(x - 5, y + 14);
        ctx.bezierCurveTo(x + 5, y + 18, x + 25, y + 18, x + 35, y + 10);
        ctx.stroke();
        
        // ‡∏ï‡∏±‡∏ß‡∏£‡∏ñ
        rect(x, y + 8, 30, 6, PALETTE.sleigh); // ‡∏ê‡∏≤‡∏ô
        rect(x - 2, y + 6, 5, 8, PALETTE.sleigh); // ‡∏û‡∏ô‡∏±‡∏Å‡∏û‡∏¥‡∏á
        rect(x + 25, y + 6, 5, 4, PALETTE.sleigh); // ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ñ‡πÇ‡∏Ñ‡πâ‡∏á
        
        // 4. ‡∏ñ‡∏∏‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç (Bag)
        rect(x + 2, y + 2, 8, 8, '#795548'); // ‡∏ñ‡∏∏‡∏á
        rect(x + 3, y + 3, 2, 2, '#EF5350'); // ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÇ‡∏ú‡∏•‡πà‡∏°‡∏≤
        rect(x + 6, y + 2, 3, 3, '#42A5F5'); // ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡πÉ‡∏ö

        // 5. ‡∏ã‡∏≤‡∏ô‡∏ï‡πâ‡∏≤ (Santa)
        rect(x + 10, y + 2, 10, 8, PALETTE.santaRed); // ‡∏ï‡∏±‡∏ß
        rect(x + 13, y - 2, 5, 5, PALETTE.skin); // ‡∏´‡∏ô‡πâ‡∏≤
        rect(x + 12, y + 1, 7, 3, '#FFF'); // ‡πÄ‡∏Ñ‡∏£‡∏≤
        rect(x + 12, y - 4, 7, 3, PALETTE.santaRed); // ‡∏´‡∏°‡∏ß‡∏Å
        rect(x + 18, y - 3, 2, 2, '#FFF'); // ‡∏õ‡∏≠‡∏°‡∏õ‡∏≠‡∏°
        rect(x + 18, y + 4, 3, 2, '#333'); // ‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠‡∏à‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å
    }

    function drawReindeer(x, y, frameOffset) {
        // ‡∏Ç‡∏≤‡∏Ç‡∏¢‡∏±‡∏ö
        const legSwing = Math.sin((frameCount + frameOffset) * 0.2) * 3;
        
        // ‡∏Ç‡∏≤‡∏´‡∏•‡∏±‡∏á
        rect(x + 2, y + 6 + legSwing, 2, 5, '#5D4037');
        rect(x + 10, y + 6 - legSwing, 2, 5, '#5D4037');
        
        // ‡∏ï‡∏±‡∏ß
        rect(x, y, 12, 7, '#795548');
        rect(x - 1, y - 1, 2, 2, '#FFF'); // ‡∏´‡∏≤‡∏á
        
        // ‡∏Ñ‡∏≠‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß
        rect(x + 10, y - 3, 4, 6, '#795548'); // ‡∏Ñ‡∏≠
        rect(x + 11, y - 6, 5, 4, '#795548'); // ‡∏´‡∏±‡∏ß
        rect(x + 15, y - 4, 1, 1, '#3E2723'); // ‡∏à‡∏°‡∏π‡∏Å
        rect(x + 12, y - 9, 4, 3, '#D7CCC8'); // ‡πÄ‡∏Ç‡∏≤
        
        // ‡∏õ‡∏•‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏¥‡πà‡∏á
        rect(x + 11, y, 2, 2, PALETTE.gold);
    }

    function drawFancyTree(obj) {
        const x = obj.x;
        const y = obj.y; // ‡∏à‡∏∏‡∏î‡∏ê‡∏≤‡∏ô
        
        // ‡∏Å‡∏£‡∏∞‡∏ñ‡∏≤‡∏á
        rect(x + 6, y - 4, 6, 4, '#3E2723');

        // ‡πÉ‡∏ö‡πÑ‡∏°‡πâ (Layered)
        const layers = 5;
        const baseW = 22;
        const layerH = 6;
        
        for (let i = 0; i < layers; i++) {
            const w = baseW - (i * 4);
            const lx = x + (baseW - w) / 2; // Center x
            const ly = y - 4 - ((i + 1) * (layerH - 1)); // Overlap slightly
            
            // ‡πÄ‡∏á‡∏≤‡πÉ‡∏ö‡πÑ‡∏°‡πâ
            rect(lx + 1, ly + 1, w, layerH, PALETTE.treeDark);
            // ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏ö‡πÑ‡∏°‡πâ‡∏´‡∏•‡∏±‡∏Å
            rect(lx, ly, w - 1, layerH - 1, PALETTE.treeLight);
            
            // Texture (Leaf noise)
            if (i % 2 === 0) rect(lx + 2, ly + 2, 2, 2, PALETTE.treeDark);
        }

        // ‡∏î‡∏≤‡∏ß‡∏ö‡∏ô‡∏¢‡∏≠‡∏î (‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏õ‡πä‡∏∞)
        const topY = y - 4 - (layers * (layerH - 1));
        // baseW ‡∏Ñ‡∏∑‡∏≠ 22, ‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏≠ 11
        // ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏ß‡πâ‡∏≤‡∏á 2 -> x = 11 - 1 = 10
        rect(x + 10, topY - 3, 2, 4, PALETTE.gold);
        // ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡∏Å‡∏ß‡πâ‡∏≤‡∏á 4 -> x = 11 - 2 = 9
        rect(x + 9, topY - 2, 4, 2, PALETTE.gold);

        // ‡πÑ‡∏ü‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö (Ornaments)
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏ü‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏ï‡πà‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (Deterministic random based on x)
        // ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ frameCount ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö
        const blink = Math.floor(frameCount / 10) % 2 === 0;
        if (blink) {
            rect(x + 5, y - 10, 2, 2, '#F44336'); // ‡πÅ‡∏î‡∏á
            rect(x + 12, y - 20, 2, 2, '#2196F3'); // ‡∏ü‡πâ‡∏≤
            rect(x + 8, y - 15, 2, 2, '#FFEB3B'); // ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á
        } else {
            rect(x + 10, y - 8, 2, 2, '#FFEB3B');
            rect(x + 6, y - 22, 2, 2, '#F44336');
        }
    }

    function drawDetailedHuman(obj) {
        const x = obj.x;
        const y = obj.y;
        
        // ‡∏Ç‡∏≤‡πÄ‡∏î‡∏¥‡∏ô
        const stride = Math.sin(frameCount * 0.15) * 3;
        rect(x, y - 8, 2, 8 + stride, '#263238'); // ‡∏Ç‡∏≤ 1
        rect(x + 4, y - 8, 2, 8 - stride, '#263238'); // ‡∏Ç‡∏≤ 2
        
        // ‡∏ï‡∏±‡∏ß‡πÄ‡∏™‡∏∑‡πâ‡∏≠
        rect(x - 1, y - 18, 8, 10, obj.color);
        // ‡∏ú‡πâ‡∏≤‡∏û‡∏±‡∏ô‡∏Ñ‡∏≠
        rect(x - 1, y - 18, 8, 2, '#FFF');
        rect(x + 4, y - 18, 2, 5 + Math.sin(frameCount * 0.2), '#FFF'); // ‡∏ä‡∏≤‡∏¢‡∏ú‡πâ‡∏≤‡∏û‡∏±‡∏ô‡∏Ñ‡∏≠‡∏õ‡∏•‡∏¥‡∏ß

        // ‡∏´‡∏±‡∏ß
        rect(x, y - 23, 6, 5, PALETTE.skin);
        // ‡∏´‡∏°‡∏ß‡∏Å‡πÑ‡∏´‡∏°‡∏û‡∏£‡∏°
        rect(x - 1, y - 25, 8, 3, obj.color);
        rect(x + 2, y - 26, 2, 1, '#FFF');
    }

    // --- LOGIC ---
    function spawnObjects() {
        if (Math.random() < 0.015) { // ‡πÄ‡∏Å‡∏¥‡∏î‡πÑ‡∏°‡πà‡∏ö‡πà‡∏≠‡∏¢‡∏°‡∏≤‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏£‡∏Å
            const choice = Math.random();
            let type = 'TREE';
            if (choice > 0.6) type = 'HUMAN';
            else if (choice > 0.4) type = 'LAMP';

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á
            const lastObj = groundObjects[groundObjects.length - 1];
            if (!lastObj || (gameWidth + 20) - lastObj.x > 40) {
                groundObjects.push({
                    type: type,
                    x: gameWidth + 20,
                    y: gameHeight - 20, // ‡∏à‡∏∏‡∏î‡∏¢‡∏∑‡∏ô
                    color: PALETTE.santaRed // default for human
                });
            }
        }
    }

    function update() {
        frameCount++;

        // Snowflakes
        if (snowParticles.length < 100) {
            snowParticles.push({
                x: Math.random() * gameWidth,
                y: -5,
                speed: 0.5 + Math.random(),
                wobble: Math.random() * Math.PI
            });
        }
        snowParticles.forEach(p => {
            p.y += p.speed;
            p.x -= scrollSpeed * 0.2 + Math.sin(p.wobble + frameCount * 0.05) * 0.5;
            if (p.y > gameHeight) {
                p.y = -5;
                p.x = Math.random() * gameWidth;
            }
        });

        // Parallax Buildings
        buildings.forEach(b => {
            b.x -= scrollSpeed * 0.25; // ‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏â‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤
            if (b.x + b.w < 0) b.x = gameWidth + Math.random() * 50;
        });

        spawnObjects();

        // Move Ground Objects
        for (let i = groundObjects.length - 1; i >= 0; i--) {
            groundObjects[i].x -= scrollSpeed;
            if (groundObjects[i].x < -30) groundObjects.splice(i, 1);
        }
    }

    function draw() {
        // 1. Sky Gradient
        const grad = ctx.createLinearGradient(0, 0, 0, gameHeight);
        grad.addColorStop(0, PALETTE.skyTop);
        grad.addColorStop(1, PALETTE.skyBottom);
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, gameWidth, gameHeight);

        // 2. Stars
        ctx.fillStyle = '#FFF';
        stars.forEach(s => {
            if (Math.sin(frameCount * s.blinkSpeed) > 0) {
                ctx.fillRect(s.x, s.y, s.size, s.size);
            }
        });

        // 3. Moon (Glowy Pixel)
        const mx = gameWidth - 50, my = 30;
        ctx.fillStyle = 'rgba(255, 215, 0, 0.2)'; // Glow
        ctx.fillRect(mx - 2, my - 2, 14, 14);
        rect(mx, my, 10, 10, PALETTE.moon);

        // 4. City Background (Silhouette)
        ctx.fillStyle = '#101025'; // ‡∏™‡∏µ‡∏ï‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏°‡πÜ
        buildings.forEach(b => {
            rect(b.x, gameHeight - 30 - b.h, b.w, b.h + 30, '#101025');
            // ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÑ‡∏ü
            if (b.windows) {
                ctx.fillStyle = '#263238'; // ‡πÑ‡∏ü‡∏°‡∏∑‡∏î‡πÜ
                if (Math.random() > 0.95) ctx.fillStyle = '#FFC107'; // ‡πÑ‡∏ü‡∏ï‡∏¥‡∏î‡∏ö‡πâ‡∏≤‡∏á‡∏î‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏á
                rect(b.x + 2, gameHeight - 30 - b.h + 4, 2, 2, ctx.fillStyle);
                rect(b.x + 6, gameHeight - 30 - b.h + 10, 2, 2, ctx.fillStyle);
            }
        });

        // 5. Road & Ground
        const groundY = gameHeight - 20;
        rect(0, groundY, gameWidth, 20, PALETTE.road); // ‡∏ñ‡∏ô‡∏ô
        rect(0, groundY, gameWidth, 2, '#CFD8DC'); // ‡∏Ç‡∏≠‡∏ö‡∏ü‡∏∏‡∏ï‡∏ö‡∏≤‡∏ó
        
        // ‡∏£‡∏±‡πâ‡∏ß‡πÑ‡∏Å‡∏• (Fence)
        const fenceSpacing = 10;
        const fenceOffset = (frameCount * scrollSpeed) % fenceSpacing;
        ctx.fillStyle = '#37474F';
        for(let i = -1; i < gameWidth/fenceSpacing + 1; i++) {
            rect((i * fenceSpacing) - fenceOffset, groundY - 6, 2, 6, '#37474F');
            rect(0, groundY - 4, gameWidth, 1, '#37474F'); // ‡∏£‡∏≤‡∏ß‡∏£‡∏±‡πâ‡∏ß
        }

        // 6. Ground Objects (Sorted by Y is not needed as they are on same line, just draw)
        groundObjects.forEach(obj => {
            if (obj.type === 'TREE') drawFancyTree(obj);
            else if (obj.type === 'HUMAN') drawDetailedHuman(obj);
            else if (obj.type === 'LAMP') {
                 // ‡πÄ‡∏™‡∏≤‡πÑ‡∏ü
                 rect(obj.x, obj.y - 35, 2, 35, '#212121');
                 rect(obj.x - 2, obj.y - 38, 6, 4, '#000');
                 rect(obj.x - 1, obj.y - 37, 4, 2, '#FFEB3B'); // ‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü
                 // ‡πÅ‡∏™‡∏á‡∏ü‡∏∏‡πâ‡∏á
                 ctx.fillStyle = 'rgba(255, 235, 59, 0.2)';
                 ctx.fillRect(obj.x - 10, obj.y - 45, 22, 22);
            }
        });

        // 7. Santa (Flying above)
        // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á X ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà, Y ‡∏•‡∏≠‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ï‡∏∂‡∏Å
        drawDetailedSanta(40, 50);

        // 8. Snow Foreground
        ctx.fillStyle = '#FFF';
        snowParticles.forEach(p => {
            ctx.fillRect(Math.floor(p.x), Math.floor(p.y), 1, 1);
        });
    }

    // Start
    resize();
    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }
    loop();

</script>

</body>
</html>
